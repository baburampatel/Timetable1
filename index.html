<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presidency University - Summer Term Timetable Generator</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="container">
                <h1>Presidency University</h1>
                <p>Summer Term Timetable Generator</p>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="app-nav">
            <div class="container">
                <div class="nav-tabs">
                    <button class="nav-tab active" data-tab="dashboard">Dashboard</button>
                    <button class="nav-tab" data-tab="import-all">Quick Import All</button>
                    <button class="nav-tab" data-tab="courses">Courses</button>
                    <button class="nav-tab" data-tab="faculty">Faculty</button>
                    <button class="nav-tab" data-tab="students">Students</button>
                    <button class="nav-tab" data-tab="rooms">Rooms</button>
                    <button class="nav-tab" data-tab="conflicts">Conflicts <span id="conflict-badge" class="status status--error" style="display: none;">0</span></button>
                    <button class="nav-tab" data-tab="timetable">Timetables</button>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="app-main container">
            
            <!-- Dashboard Tab -->
            <section id="dashboard" class="tab-content active">
                <div class="dashboard-grid">
                    <div class="card dashboard-card">
                        <div class="card__body">
                            <h3>Courses</h3>
                            <div class="stat-number" id="courses-count">0</div>
                            <p>Total courses configured</p>
                        </div>
                    </div>
                    <div class="card dashboard-card">
                        <div class="card__body">
                            <h3>Faculty</h3>
                            <div class="stat-number" id="faculty-count">0</div>
                            <p>Total faculty members</p>
                        </div>
                    </div>
                    <div class="card dashboard-card">
                        <div class="card__body">
                            <h3>Students</h3>
                            <div class="stat-number" id="students-count">0</div>
                            <p>Total students enrolled</p>
                        </div>
                    </div>
                    <div class="card dashboard-card">
                        <div class="card__body">
                            <h3>Rooms</h3>
                            <div class="stat-number" id="rooms-count">0</div>
                            <p>Total rooms available</p>
                        </div>
                    </div>
                    <div class="card dashboard-card">
                        <div class="card__body">
                            <h3>Conflicts</h3>
                            <div class="stat-number" id="conflicts-count" style="color: var(--color-error);">0</div>
                            <p>Total scheduling conflicts</p>
                        </div>
                    </div>
                </div>

                <!-- CSV Import Section -->
                <div class="csv-import-section">
                    <h3>Quick Import Options</h3>
                    <div class="import-grid">
                        <div class="card import-card import-all-card">
                            <div class="card__body">
                                <h4>üöÄ Quick Import All</h4>
                                <p>Import all data types from one master CSV file</p>
                                <button class="btn btn--primary btn--sm" onclick="openBulkImportModal()">Import All Data</button>
                                <button class="btn btn--outline btn--sm" id="btn-download-bulk">Download Template</button>
                            </div>
                        </div>
                        <div class="card import-card">
                            <div class="card__body">
                                <h4>Import Courses</h4>
                                <p>Upload CSV file with course data</p>
                                <button class="btn btn--secondary btn--sm" onclick="openImportModal('courses')">Import CSV</button>
                                <button class="btn btn--outline btn--sm" id="btn-download-courses-template">Download Template</button>
                            </div>
                        </div>
                        <div class="card import-card">
                            <div class="card__body">
                                <h4>Import Faculty</h4>
                                <p>Upload CSV file with faculty data</p>
                                <button class="btn btn--secondary btn--sm" onclick="openImportModal('faculty')">Import CSV</button>
                                <button class="btn btn--outline btn--sm" id="btn-download-faculty-template">Download Template</button>
                            </div>
                        </div>
                        <div class="card import-card">
                            <div class="card__body">
                                <h4>Import Students</h4>
                                <p>Upload CSV file with student data</p>
                                <button class="btn btn--secondary btn--sm" onclick="openImportModal('students')">Import CSV</button>
                                <button class="btn btn--outline btn--sm" id="btn-download-students-template">Download Template</button>
                            </div>
                        </div>
                        <div class="card import-card">
                            <div class="card__body">
                                <h4>Import Rooms</h4>
                                <p>Upload CSV file with room data</p>
                                <button class="btn btn--secondary btn--sm" onclick="openImportModal('rooms')">Import CSV</button>
                                <button class="btn btn--outline btn--sm" id="btn-download-rooms-template">Download Template</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="dashboard-actions">
                    <button class="btn btn--primary btn--lg" id="load-sample-data">Load Sample Data</button>
                    <button class="btn btn--secondary btn--lg" id="generate-timetable" disabled>Generate Timetables</button>
                </div>
            </section>

            <!-- Quick Import All Tab -->
            <section id="import-all" class="tab-content">
                <div class="section-header">
                    <h2>Quick Import All Data</h2>
                    <div class="section-actions">
                        <button class="btn btn--outline" id="btn-download-bulk-2">Download Template</button>
                        <button class="btn btn--primary" onclick="openBulkImportModal()">Import Master CSV</button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card__body">
                        <h3>Bulk Import Instructions</h3>
                        <p>Use the bulk import feature to import all your data at once from a single CSV file. The master CSV should contain all entity types (Courses, Faculty, Students, Rooms) in a standardized format.</p>
                        
                        <h4>CSV Format Requirements:</h4>
                        <ul>
                            <li><strong>TYPE column:</strong> Specify the data type (COURSE, FACULTY, STUDENT, ROOM)</li>
                            <li><strong>ID column:</strong> Unique identifier for each entity</li>
                            <li><strong>Name column:</strong> Display name for the entity</li>
                            <li><strong>Field1-Field5:</strong> Additional data fields specific to each type</li>
                        </ul>

                        <h4>Sample Data Structure:</h4>
                        <div class="code-preview">
                            <pre>TYPE,ID,Name,Field1,Field2,Field3,Field4,Field5
COURSE,CS101,Programming Fundamentals,3,Dr. Smith,"S001,S003,S005",,
FACULTY,F001,Dr. Smith,CS101,"Mon-9,Mon-10,Wed-9,Wed-10",,
STUDENT,S001,Alice Johnson,"CS101,PH301",,,,
ROOM,R101,Room 101,30,"Mon-9,Mon-10,Tue-9,Tue-10",,,</pre>
                        </div>

                        <div class="import-status" id="bulk-import-status" style="display: none;">
                            <h4>Import Status</h4>
                            <div class="import-summary" id="import-summary"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Courses Tab -->
            <section id="courses" class="tab-content">
                <div class="section-header">
                    <h2>Course Management</h2>
                    <div class="section-actions">
                        <button class="btn btn--secondary" onclick="openImportModal('courses')">Import CSV</button>
                        <button class="btn btn--primary" id="add-course">Add Course</button>
                    </div>
                </div>
                <div class="card">
                    <div class="card__body">
                        <div class="form-grid" id="course-form" style="display: none;">
                            <div class="form-group">
                                <label class="form-label">Course Code</label>
                                <input type="text" class="form-control" id="course-id" placeholder="e.g., CS101">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Course Name</label>
                                <input type="text" class="form-control" id="course-name" placeholder="e.g., Programming Fundamentals">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Sessions per Week</label>
                                <select class="form-control" id="course-sessions">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Assigned Faculty</label>
                                <select class="form-control" id="course-faculty">
                                    <option value="">Select Faculty</option>
                                </select>
                            </div>
                            <div class="form-actions">
                                <button class="btn btn--primary" id="save-course">Save Course</button>
                                <button class="btn btn--outline" id="cancel-course">Cancel</button>
                            </div>
                        </div>
                        <div class="data-table" id="courses-table"></div>
                    </div>
                </div>
            </section>

            <!-- Faculty Tab -->
            <section id="faculty" class="tab-content">
                <div class="section-header">
                    <h2>Faculty Management</h2>
                    <div class="section-actions">
                        <button class="btn btn--secondary" onclick="openImportModal('faculty')">Import CSV</button>
                        <button class="btn btn--primary" id="add-faculty">Add Faculty</button>
                    </div>
                </div>
                <div class="card">
                    <div class="card__body">
                        <div class="form-grid" id="faculty-form" style="display: none;">
                            <div class="form-group">
                                <label class="form-label">Faculty ID</label>
                                <input type="text" class="form-control" id="faculty-id" placeholder="e.g., F001">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Faculty Name</label>
                                <input type="text" class="form-control" id="faculty-name" placeholder="e.g., Dr. Smith">
                            </div>
                            <div class="form-actions">
                                <button class="btn btn--primary" id="save-faculty">Save Faculty</button>
                                <button class="btn btn--outline" id="cancel-faculty">Cancel</button>
                            </div>
                        </div>
                        <div class="data-table" id="faculty-table"></div>
                    </div>
                </div>
            </section>

            <!-- Students Tab -->
            <section id="students" class="tab-content">
                <div class="section-header">
                    <h2>Student Management</h2>
                    <div class="section-actions">
                        <button class="btn btn--secondary" onclick="openImportModal('students')">Import CSV</button>
                        <button class="btn btn--primary" id="add-student">Add Student</button>
                    </div>
                </div>
                <div class="card">
                    <div class="card__body">
                        <div class="form-grid" id="student-form" style="display: none;">
                            <div class="form-group">
                                <label class="form-label">Student ID</label>
                                <input type="text" class="form-control" id="student-id" placeholder="e.g., S001">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Student Name</label>
                                <input type="text" class="form-control" id="student-name" placeholder="e.g., Alice Johnson">
                            </div>
                            <div class="form-actions">
                                <button class="btn btn--primary" id="save-student">Save Student</button>
                                <button class="btn btn--outline" id="cancel-student">Cancel</button>
                            </div>
                        </div>
                        <div class="data-table" id="students-table"></div>
                    </div>
                </div>
            </section>

            <!-- Rooms Tab -->
            <section id="rooms" class="tab-content">
                <div class="section-header">
                    <h2>Room Management</h2>
                    <div class="section-actions">
                        <button class="btn btn--secondary" onclick="openImportModal('rooms')">Import CSV</button>
                        <button class="btn btn--primary" id="add-room">Add Room</button>
                    </div>
                </div>
                <div class="card">
                    <div class="card__body">
                        <div class="form-grid" id="room-form" style="display: none;">
                            <div class="form-group">
                                <label class="form-label">Room ID</label>
                                <input type="text" class="form-control" id="room-id" placeholder="e.g., R101">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Room Name</label>
                                <input type="text" class="form-control" id="room-name" placeholder="e.g., Room 101">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Capacity</label>
                                <input type="number" class="form-control" id="room-capacity" placeholder="e.g., 30">
                            </div>
                            <div class="form-actions">
                                <button class="btn btn--primary" id="save-room">Save Room</button>
                                <button class="btn btn--outline" id="cancel-room">Cancel</button>
                            </div>
                        </div>
                        <div class="data-table" id="rooms-table"></div>
                    </div>
                </div>
            </section>

            <!-- Conflicts Tab -->
            <section id="conflicts" class="tab-content">
                <div class="section-header">
                    <h2>Scheduling Conflicts</h2>
                    <div class="section-actions">
                        <button class="btn btn--secondary" id="detect-conflicts">Detect Conflicts</button>
                        <button class="btn btn--outline" id="btn-export-conflicts-csv">Export Report</button>
                    </div>
                </div>
                
                <div class="conflicts-summary" id="conflicts-summary">
                    <div class="conflict-stats">
                        <div class="card">
                            <div class="card__body">
                                <h3>Conflict Statistics</h3>
                                <div class="stats-grid">
                                    <div class="stat-item">
                                        <span class="stat-label">Total Conflicts</span>
                                        <span class="stat-value" id="total-conflicts">0</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">High Priority</span>
                                        <span class="stat-value error" id="high-conflicts">0</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Medium Priority</span>
                                        <span class="stat-value warning" id="medium-conflicts">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="conflicts-list" id="conflicts-list">
                    <div class="card">
                        <div class="card__body">
                            <h3>Detected Conflicts</h3>
                            <p class="no-conflicts">No conflicts detected. Run conflict detection to check for scheduling issues.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Timetables Tab -->
            <section id="timetable" class="tab-content">
                <div class="section-header">
                    <h2>Generated Timetables</h2>
                    <div class="timetable-actions">
                        <button class="btn btn--secondary" id="regenerate-timetable">Regenerate</button>
                        <button class="btn btn--outline" id="btn-export-master-csv">Export CSV</button>
                        <button class="btn btn--outline" id="btn-export-master-pdf">Export PDF</button>
                    </div>
                </div>

                <!-- Timetable View Selector -->
                <div class="timetable-views">
                    <div class="view-selector">
                        <button class="view-btn active" data-view="master">Master Timetable</button>
                        <button class="view-btn" data-view="faculty">Faculty Timetables</button>
                        <button class="view-btn" data-view="rooms">Room Search</button>
                    </div>
                </div>
                
                <div class="generation-status" id="generation-status" style="display: none;">
                    <div class="card">
                        <div class="card__body">
                            <h3>Generating Timetables...</h3>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progress-fill"></div>
                            </div>
                            <p id="progress-text">Initializing...</p>
                        </div>
                    </div>
                </div>

                <!-- Master Timetable View -->
                <div class="timetable-view active" id="master-view">
                    <div class="timetable-container">
                        <div class="card">
                            <div class="card__body">
                                <h3>Master Timetable</h3>
                                <div class="timetable-grid" id="timetable-grid"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Faculty Timetables View -->
                <div class="timetable-view" id="faculty-view">
                    <div class="faculty-selector">
                        <div class="form-group">
                            <label class="form-label">Select Faculty Member</label>
                            <select class="form-control" id="faculty-select">
                                <option value="">Choose a faculty member</option>
                            </select>
                        </div>
                        <button class="btn btn--outline" id="btn-export-faculty-csv">Export Faculty CSV</button>
                        <button class="btn btn--outline" id="btn-export-faculty-pdf">Export Faculty PDF</button>
                    </div>
                    <div class="faculty-timetable-container">
                        <div class="card">
                            <div class="card__body">
                                <h3 id="faculty-timetable-title">Select a faculty member to view their schedule</h3>
                                <div class="faculty-timetable-grid" id="faculty-timetable-grid"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Room Search View -->
                <div class="timetable-view" id="rooms-view">
                    <div class="room-search-controls">
                        <div class="search-filters">
                            <div class="form-group">
                                <label class="form-label">Search Rooms</label>
                                <input type="text" class="form-control" id="room-search" placeholder="Search by room name or ID">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Filter by Time</label>
                                <select class="form-control" id="time-filter">
                                    <option value="">All times</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Filter by Day</label>
                                <select class="form-control" id="day-filter">
                                    <option value="">All days</option>
                                    <option value="Monday">Monday</option>
                                    <option value="Tuesday">Tuesday</option>
                                    <option value="Wednesday">Wednesday</option>
                                    <option value="Thursday">Thursday</option>
                                    <option value="Friday">Friday</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <button class="btn btn--outline" id="btn-export-room-csv">Export Room Report</button>
                            </div>
                        </div>
                    </div>
                    <div class="room-search-results">
                        <div class="card">
                            <div class="card__body">
                                <h3>Room Utilization</h3>
                                <div class="room-grid" id="room-grid"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Bulk Import Modal -->
    <div class="modal hidden" id="bulk-import-modal">
        <div class="modal-overlay" id="bulk-import-overlay"></div>
        <div class="modal-content bulk-import-content">
            <div class="modal-header">
                <h3>Quick Import All Data</h3>
                <button class="modal-close" id="bulk-import-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="bulk-import-step">
                    <h4>Upload Master CSV File</h4>
                    <p>Upload a single CSV file containing all your data (Courses, Faculty, Students, Rooms)</p>
                    <div class="upload-zone" id="bulk-upload-zone">
                        <div class="upload-content">
                            <div class="upload-icon">üìÅ</div>
                            <p>Drag and drop your master CSV file here, or click to browse</p>
                            <input type="file" id="bulk-csv-input" accept=".csv" style="display: none;">
                            <button class="btn btn--secondary" onclick="document.getElementById('bulk-csv-input').click()">Choose File</button>
                        </div>
                    </div>
                    <div class="file-info" id="bulk-file-info" style="display: none;">
                        <p><strong>Selected file:</strong> <span id="bulk-file-name"></span></p>
                        <p><strong>Size:</strong> <span id="bulk-file-size"></span></p>
                    </div>
                </div>

                <div class="bulk-import-results" id="bulk-import-results" style="display: none;">
                    <h4>Import Results</h4>
                    <div class="import-summary-grid">
                        <div class="summary-item">
                            <span class="summary-label">Courses</span>
                            <span class="summary-value" id="courses-imported">0</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Faculty</span>
                            <span class="summary-value" id="faculty-imported">0</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Students</span>
                            <span class="summary-value" id="students-imported">0</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Rooms</span>
                            <span class="summary-value" id="rooms-imported">0</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Conflicts</span>
                            <span class="summary-value error" id="conflicts-detected">0</span>
                        </div>
                    </div>
                    <div class="import-conflicts" id="import-conflicts" style="display: none;">
                        <h5>Import Conflicts Detected:</h5>
                        <div id="import-conflicts-list"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn--primary" id="process-bulk-import" style="display: none;">Process Import</button>
                <button class="btn btn--outline" id="cancel-bulk-import">Cancel</button>
            </div>
        </div>
    </div>

    <!-- CSV Import Modal -->
    <div class="modal hidden" id="import-modal">
        <div class="modal-overlay" id="import-modal-overlay"></div>
        <div class="modal-content import-modal-content">
            <div class="modal-header">
                <h3 id="import-modal-title">Import CSV Data</h3>
                <button class="modal-close" id="import-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="import-steps">
                    <!-- Step 1: File Upload -->
                    <div class="import-step active" id="upload-step">
                        <h4>Step 1: Upload CSV File</h4>
                        <div class="upload-zone" id="upload-zone">
                            <div class="upload-content">
                                <div class="upload-icon">üìÅ</div>
                                <p>Drag and drop your CSV file here, or click to browse</p>
                                <input type="file" id="csv-file-input" accept=".csv" style="display: none;">
                                <button class="btn btn--secondary" onclick="document.getElementById('csv-file-input').click()">Choose File</button>
                            </div>
                        </div>
                        <div class="file-info" id="file-info" style="display: none;">
                            <p><strong>Selected file:</strong> <span id="file-name"></span></p>
                            <p><strong>Size:</strong> <span id="file-size"></span></p>
                        </div>
                    </div>

                    <!-- Step 2: Data Preview -->
                    <div class="import-step" id="preview-step">
                        <h4>Step 2: Preview Data</h4>
                        <div class="preview-info">
                            <p>Review the data below and resolve any issues before importing.</p>
                            <div class="import-stats">
                                <span class="status status--info" id="total-rows">0 rows found</span>
                                <span class="status status--success" id="valid-rows">0 valid</span>
                                <span class="status status--error" id="error-rows">0 errors</span>
                            </div>
                        </div>
                        <div class="preview-table-container">
                            <div id="preview-table"></div>
                        </div>
                        <div class="validation-errors" id="validation-errors" style="display: none;">
                            <h5>Validation Errors:</h5>
                            <div id="error-list"></div>
                        </div>
                    </div>

                    <!-- Step 3: Import Options -->
                    <div class="import-step" id="options-step">
                        <h4>Step 3: Import Options</h4>
                        <div class="import-options">
                            <div class="form-group">
                                <label class="form-label">
                                    <input type="radio" name="import-mode" value="append" checked> 
                                    Append to existing data
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="form-label">
                                    <input type="radio" name="import-mode" value="replace"> 
                                    Replace all existing data
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="form-label">
                                    <input type="checkbox" id="skip-duplicates" checked> 
                                    Skip duplicate entries
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="import-progress" id="import-progress" style="display: none;">
                    <h4>Importing Data...</h4>
                    <div class="progress-bar">
                        <div class="progress-fill" id="import-progress-fill"></div>
                    </div>
                    <p id="import-progress-text">Processing...</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn--primary" id="prev-step" style="display: none;">Previous</button>
                <button class="btn btn--primary" id="next-step">Next</button>
                <button class="btn btn--primary" id="import-data" style="display: none;">Import Data</button>
                <button class="btn btn--outline" id="cancel-import">Cancel</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>